# Домашнее задание к занятию «Ассиметричные криптосистемы»

В качестве результата пришлите ответы на вопросы в личном кабинете студента на сайте [netology.ru](https://netology.ru).

## Общие замечания по безопасности

При скачивании любых файлов перед их открытием рекомендуем вам проверять их с помощью сервиса [VirusTotal](https://www.virustotal.com/gui/home/upload).

## Общие замечания по выполнению ДЗ

Если у вас что-то не получилось, то пишите в канал курса, обязательно указывая:
1. Номер ДЗ
1. ОС
1. На каком шаге остановились
1. Скриншот ошибки
1. Краткое описание того, что сделали

Пожалуйста, не пишите сообщения в стиле `я всё сделал по инструкции, ничего не работает` - это никоим образом не поможет решить проблему.

## Работа в терминале

Ознакомьтесь с [руководством по работе в терминале](../terminal) для вашей операционной системы.

## Задача LibreSSL & OpenSSL

### Справка 

[OpenSSL](https://www.openssl.org/) - Open Source криптографическая библиотека.

[LibreSSL](https://www.libressl.org/) - форк (ответвление) от библиотеки OpenSSL, развиваемое в рамках проекта OpenBSD.

### Установка

#### Windows

Пользователем Windows мы предлагаем воспользоваться возможностями проекта [Cygwin](https://www.cygwin.com), который предоставляет набор инструментов из мира Linux для ОС Windows.

<details>
<summary>Инструкция по установке</summary>

##### Шаг 0. Перейдите на главную страницу и скачайте установочный файл:

![](pic/cygwin-00.png)

##### Шаг 1. После чего запустите его на установку и нажмите на кнопку Далее:

![](pic/cygwin-01.png)

##### Шаг 2. Оставьте значение по умолчанию (Install from Internet) и нажмите на кнопку Далее:

![](pic/cygwin-02.png)

##### Шаг 3. Оставьте значения по умолчанию и нажмите на кнопку Далее:

![](pic/cygwin-03.png)

##### Шаг 4. Оставьте значения по умолчанию и нажмите на кнопку Далее:

![](pic/cygwin-04.png)

##### Шаг 5. Оставьте значения по умолчанию и нажмите на кнопку Далее:

![](pic/cygwin-05.png)

##### Шаг 6. Выберите любой сервер из списка и нажмите на кнопку Далее:

![](pic/cygwin-06.png)

##### Шаг 7. Оставьте значения по умолчанию и нажмите на кнопку Далее:

![](pic/cygwin-07.png)

##### Шаг 8. Оставьте значения по умолчанию и нажмите на кнопку Готово:

![](pic/cygwin-08.png)

##### Шаг 9. Откройте Cygwin Terminal через иконку на Рабочем Столе:

![](pic/cygwin-09.png)

##### Шаг 10. Введите команду `openssl version` (можете продолжать работу):

![](pic/cygwin-10.png)

По умолчанию вы будете находиться в каталоге `C:/cygwin64/home/<Имя вашего пользователя>`.

</details>

#### Linux

Для пользователей Linux (Ubuntu) необходимо выполнить в терминале команду: `openssl version`. Если в результате вы видите вывод вроде `OpenSSL 1.1.1f  31 Mar 2020` (версия и дата могут отличаться) а не `Command 'openssl' not found`, тогда вам не нужно ничего устанавливать.

Если же вы получили сообщение о том, что команда `openssl` не найдена, выполните следующую команду: `sudo apt-get install openssl`.

#### Mac OS

Для пользователей Mac необходимо выполнить в терминале команду: `openssl version`. Если в результате вы видите вывод вроде `LibreSSL 2.8.3` (версия может отличаться) а не `Command 'openssl' not found`, тогда вам не нужно ничего устанавливать.

Если же вы получили сообщение о том, что команда `openssl` не найдена, выполните следующую команду: `brew install openssl`.

### Инструкция 

Запустите терминал и начнём знакомиться с OpenSSL (LibreSSL):

1\. Справка по основным командам OpenSSL

```shell script
openssl help
```

2\. Справка по конкретной команде:

```shell script
openssl help genrsa
```

Более детальную справку вы можете найти по адресу: https://www.openssl.org/docs/manmaster/man1/

### Задача

В этой задаче мы научимся шифровать данные с помощью публичного ключа и расшифровывать с помощью приватного.

Первое, с чего мы должны начать - это сгенерировать ключ. Для этого нужно выбрать алгоритм, размер ключа и passphrase (кодовую фразу).

#### Шаг 1. Создайте закрытый ключ с длиной 2048:

```shell script
openssl genpkey -algorithm RSA -pkeyopt rsa_keygen_bits:2048 -aes256 -out private.key
```

Где [`genpkey`](https://www.openssl.org/docs/manmaster/man1/openssl-genpkey.html) - подкоманда, отвечающая за генерацию ключей.

Введите кодовую фразу два раза (обратите внимание, символы не будут отображаться в целях безопасности).

Откройте файл `private.key` в любом текстовом редакторе (можете просмотреть в терминале с помощью команды `cat private.key`), удостоверьтесь, что он выглядит примерно так:

```text
-----BEGIN ENCRYPTED PRIVATE KEY-----
...
МНОГО БУКВ
...
-----END ENCRYPTED PRIVATE KEY-----
```

#### Шаг 2. Сгенерируйте открытый ключ на базе закрытого: 

```shell script
openssl pkey -pubout -in private.key -out public.key
```

Где [`pkey`](https://www.openssl.org/docs/man1.0.2/man1/pkey.html) - подкоманда, отвечающая за обработку ключей.

Откройте файл `public.key` (можете просмотреть в терминале с помощью команды `cat private.key`) в любом текстовом редакторе, удостоверьтесь, что он выглядит примерно так:

```text
-----BEGIN PUBLIC KEY-----
...
МНОГО БУКВ
...
-----END PUBLIC KEY-----
```

#### Шаг 3. Создайте файл message.txt со своей фамилией

#### Шаг 4. Зашифруйте сообщение с помощью публичного ключа: 

```shell script
openssl pkeyutl -encrypt -pubin -inkey public.key -in message.txt -out cypher.txt
```

Где [`pkeyutl`](https://www.openssl.org/docs/manmaster/man1/openssl-pkeyutl.html) - подкоманда, отвечающая за низкоуровневые операции с публичными ключами (включая шифрование и расшифрование).

Откройте файл `cypher.txt` в любом текстовом редакторе, удостоверьтесь, что он не читабелен.

#### Шаг 5. Убедитесь, что файл `cyper.txt` расшифровывается:

```shell script
openssl pkeyutl -decrypt -inkey private.key -in cypher.txt -out decrypted.txt
```

### Результат

В качестве результата пришлите:
1. Публичный и приватный ключ
1. Passphrase
1. Зашифрованный файл
